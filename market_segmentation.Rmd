---
title: "Market segmentation"
author: "Kristen Lowe"
date: "2024-08-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, message=FALSE}
# import R libraries
library(tidyverse)
library(cluster)
library(foreach)
library(ClusterR)
library(mosaic)
library(reshape2)
```

```{r}
social_marketing <- read_csv('data/social_marketing.csv', show_col_types = FALSE) %>% 
  dplyr::select(-chatter, -uncategorized, -adult, -spam)

# find optimal number of clusters
X = scale(social_marketing[,2:33]) # cluster on measurables
k_grid = seq(2, 30, by=1)
SSE_grid = foreach(k = k_grid, .combine='c') %do% {
  cluster_k = kmeans(X, k, nstart=50)
  cluster_k$tot.withinss
}
plot(k_grid, SSE_grid)

# Extract the centers and scales from the rescaled data (which are named attributes)
mu = attr(X,"scaled:center")
sigma = attr(X,"scaled:scale")

# Run k-means with 11 clusters and 25 starts
clust1 = kmeans(X, 11, nstart=25)

# Convert the cluster centers into a data frame
centers_df <- as.data.frame(clust1$centers)

# Add a column for cluster numbers
centers_df$cluster <- rownames(centers_df)

# Melt the data frame, keeping the Cluster column as an id variable
centers_melted <- melt(centers_df, id.vars = "cluster", variable.name = "variable", value.name = "value")

# Plot the heatmap
ggplot(centers_melted, aes(x = variable, y = cluster, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0) +
  labs(title = "Heatmap of Cluster Centers", x = "Variables", y = "Clusters") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

column_sums <- colSums(social_marketing[,2:33], na.rm = TRUE)

# Convert the sums into a data frame for easier merging
sums_df <- data.frame(
  variable = names(column_sums),
  prevalence = column_sums
)

centers_melted %>%
  group_by(variable) %>% 
  slice_max(order_by = value, n = 1) %>%
  select(variable, cluster, max_value = value) %>% 
  mutate(cluster = as.numeric(cluster)) %>% 
  arrange(cluster) %>%
  left_join(sums_df, by = "variable")
```

For the purpose of this analysis, I will define "market segment" as a cluster of interests. Based on my analysis, there are three market segments that appear most often in NutrientH2O's social media audience. These include the clusters with:

* travel and politics
* photo sharing and cooking
* health nutrition and personal fitness

If NutrientH20 wants to hone its messages more to its current social-media audience, they should create online-advertising campaigns centered around these three market segments.